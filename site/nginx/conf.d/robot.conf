server {
  listen 80;
  server_name _;

  # Serve dashboard
  root /usr/share/nginx/html;
  location = / { try_files /index.html =404; }
  location / { try_files $uri /index.html; }

  # Netstatus API
  location /api/netstatus/ {
    proxy_pass http://netstatus:5000/;
    proxy_set_header Host $host;
    proxy_http_version 1.1;
    proxy_buffering off;
    proxy_request_buffering off;
  }

  # MJPEG stream (no buffering!)
  location /stream {
    proxy_pass http://web-video-server:8080/stream;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_buffering off;
    proxy_request_buffering off;
    proxy_cache off;
    chunked_transfer_encoding off;
    proxy_read_timeout 1h;
    add_header X-Accel-Buffering no;
    add_header Cache-Control no-cache;
  }

  # Optional: topic listing passthrough
  location /streams {
    proxy_pass http://web-video-server:8080/streams;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_buffering off;
    proxy_request_buffering off;
    add_header X-Accel-Buffering no;
  }

  # site/nginx/conf.d/robot.conf
  location /snapshot {
    proxy_pass http://web-video-server:8080/snapshot;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_buffering off;
    proxy_request_buffering off;
    proxy_cache off;
    add_header X-Accel-Buffering no;
    add_header Cache-Control no-cache;
  }

}
