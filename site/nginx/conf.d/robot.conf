server {
  listen 80 default_server;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Resolve Docker service names at request time
  resolver 127.0.0.11 ipv6=off valid=30s;

  # Health check
  location = /healthz { return 200 'ok'; add_header Content-Type text/plain; }

  # ---- Netstatus ----
  set $netstatus http://netstatus:5000;
  location = /status         { proxy_pass $netstatus/status; }
  location = /status_temp    { proxy_pass $netstatus/status_temp; }
  location = /status_uptime  { proxy_pass $netstatus/status_uptime; }

  # ---- Web Video Server ----
  set $wvs http://web-video-server:8080;
  location /stream   { proxy_http_version 1.1; proxy_buffering off; proxy_pass $wvs/stream; }
  location /snapshot { proxy_pass $wvs/snapshot; }
}
