# Robust reverse-proxy for dashboard
# Uses Docker's embedded DNS resolver so names resolve at startup and at runtime.
resolver 127.0.0.11 ipv6=off;
resolver_timeout 5s;

upstream telem { server netstatus:5000; }
upstream wvs   { server web-video-server:8080; }

server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Telemetry JSON endpoints
  location = /status         { proxy_pass http://telem/status; }
  location = /status_temp    { proxy_pass http://telem/status_temp; }
  location = /status_uptime  { proxy_pass http://telem/status_uptime; }

  # Video (web_video_server)
  location = /stream         { proxy_pass http://wvs/stream; }
  location = /snapshot       { proxy_pass http://wvs/snapshot; }
}
