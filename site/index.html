<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Robot Dashboard</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;margin:0;background:#0b0f14;color:#e8f0f6}
header{padding:16px 20px;border-bottom:1px solid #1c2530;background:#0f141b}
.wrap{max-width:1080px;margin:0 auto;padding:16px 20px}
.grid{display:grid;gap:16px;grid-template-columns:1.2fr 0.8fr}
.card{background:#0f141b;border:1px solid #1c2530;border-radius:14px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.25)}
.title{font-size:18px;margin:0 0 10px 0;color:#9ec3ff}
.kv{display:flex;justify-content:space-between;margin:6px 0}.kv span{opacity:.8}
.video{width:100%;height:auto;border-radius:10px;background:#111}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
@media (max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head><body>
<header><strong>RPi-Robot Dashboard</strong></header>
<div class="wrap">
  <div class="grid">
    <div class="card">
      <h3 class="title">Camera</h3>
      <img id="stream" class="video" src="/mjpeg" alt="Robot Video Stream"/>
    </div>
    <div class="card">
      <h3 class="title">System Status</h3>
      <div class="kv"><span>CPU Temp</span><strong id="cpuTemp">â€”</strong></div>
      <div class="kv"><span>Uptime</span><strong id="uptime">â€”</strong></div>
      <hr style="border:0;border-top:1px solid #1c2530;margin:10px 0"/>
      <div class="kv"><span>Load</span><strong id="load">â€”</strong></div>
      <div class="kv"><span>CPU %</span><strong id="cpu">â€”</strong></div>
      <div class="kv"><span>Mem</span><strong id="mem">â€”</strong></div>
      <div class="kv"><span>Disk</span><strong id="disk">â€”</strong></div>
      <details style="margin-top:10px"><summary>Raw status</summary>
        <pre id="raw" class="mono" style="white-space:pre-wrap"></pre>
      </details>
    </div>
  </div>
</div>
<script>
const fmtUp=s=>{s=+s||0;const d=Math.floor(s/86400),h=Math.floor((s%86400)/3600),m=Math.floor((s%3600)/60);return (d?d+'d ':'')+h+'h '+m+'m'};
async function tick(){
  try{
    const r=await fetch('/api/netstatus',{cache:'no-store'});
    if(!r.ok) throw new Error(r.status);
    const s=await r.json();
    document.getElementById('cpuTemp').textContent=(parseFloat(s.cpu_temp_c)||0).toFixed(1)+' Â°C';
    document.getElementById('uptime').textContent = s.uptime_hms || fmtUp(s.uptime_seconds);
    document.getElementById('load').textContent   = s.load_1 ?? 'â€”';
    document.getElementById('cpu').textContent    = s.cpu_percent ?? 'â€”';
    document.getElementById('mem').textContent    = s.mem_used ?? (s.mem_used_mb&&s.mem_total_mb?`${s.mem_used_mb}MB/${s.mem_total_mb}MB`:'â€”');
    document.getElementById('disk').textContent   = s.disk_used ?? (s.disk_used_gb&&s.disk_total_gb?`${s.disk_used_gb}GB/${s.disk_total_gb}GB`:'â€”');
    document.getElementById('raw').textContent    = JSON.stringify(s,null,2);
  }catch(e){}finally{ setTimeout(tick,2000); }
}
tick();
</script>
<script>
async function refreshStats() {
  try {
    const r = await fetch('/status');
    if (!r.ok) throw new Error(r.status);
    const d = await r.json();

    // temp
    document.getElementById('tempValue').textContent =
      (d.cpu_temp_c != null) ? d.cpu_temp_c.toFixed(1) + ' °C' : '—';

    // uptime (seconds -> pretty)
    if (typeof d.uptime_seconds === 'number') {
      const s = d.uptime_seconds, days=Math.floor(s/86400),
            hrs=Math.floor((s%86400)/3600), mins=Math.floor((s%3600)/60);
      document.getElementById('uptimeValue').textContent = `${days}d ${hrs}h ${mins}m`;
    } else document.getElementById('uptimeValue').textContent = '—';

    // load 1/5/15
    if (Array.isArray(d.cpu?.load_avg) && d.cpu.load_avg.length >= 3) {
      const [l1,l5,l15] = d.cpu.load_avg;
      document.getElementById('loadValue').textContent =
        `${l1.toFixed(2)}, ${l5.toFixed(2)}, ${l15.toFixed(2)}`;
    } else document.getElementById('loadValue').textContent = '—';

    // cpu %, mem %, disk %
    document.getElementById('cpuValue').textContent =
      (d.cpu?.percent != null) ? d.cpu.percent.toFixed(0) + '%' : '—';
    document.getElementById('memValue').textContent =
      (d.memory?.percent != null) ? d.memory.percent.toFixed(0) + '%' : '—';
    document.getElementById('diskValue').textContent =
      (d.disk?.percent != null) ? d.disk.percent.toFixed(0) + '%' : '—';
  } catch (e) {
    console.error('refreshStats failed:', e);
  }
}
setInterval(refreshStats, 3000);
window.addEventListener('load', refreshStats);
</script>
</body></html>
